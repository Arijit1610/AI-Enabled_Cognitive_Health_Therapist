<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
	<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename = 'assets/favicon.ico')}}" />
    <link rel="stylesheet" href="{{ url_for('static', filename = 'css/appointment_style.css')}}">
</head>
<body>
    <div class="heading">
        <h1>Book Your Appointment</h1>
    </div>
  
    <div class="main">
    
        <section class="query-cover">
            <div class="container">
                <div class="contact-box">
                    <div class="contact-right">
                        <marquee>You Need To Required To Fill Mandatory(*) Fields.</marquee>
                        <form action="{{th_id}}" method="post" enctype="multipart/form-data">
                            <div class="user_pic">
                                <div id="image">
                                    <img src="{{ profile_image }}" alt="Profile Picture" id="profile-pic">
                                 </div>
                                 <label for="input-file" id="update">Update Image</label>
                                 <input type="file" name="inputfile" id="input-file" accept="image/jpeg, image/jpg, image/png" id="input-file">
                            </div>
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Patient Name <span>*</span></label>
                                    <input type="text" name="name" value="{{user.full_name}}" required />
                                </div>

                                <div class="input-group">
                                    <label>Date Of Birth <span>*</span></label>
                                    <input type="date" name="dob"  value="{{user.dob}}" required placeholder="" />
                                </div>
                                
                            </div>

                            <div class="input-row">
                                <div class="input-group">
                                    <label>Gender <span>*</span></label>
                                    <select name="gender" required>
                                        <option value="Male" {% if user.gender=="Male" %}selected{% endif %}>Male</option>
                                        <option value="Female" {% if user.gender=="Female" %}selected{% endif %}>Female</option>
                                        <option  value="Other" {% if user.gender=="Other" %}selected{% endif %}>Other</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label>Bload Group <span>*</span></label>
                                    <select>
                                        <option value="A+" {% if user.blood_group=="A+" %}selected{% endif %}>A+
										</option>
										<option value="B+" {% if user.blood_group=="B+" %}selected{% endif %}>B+
										</option>
										<option value="O+" {% if user.blood_group=="O+" %}selected{% endif %}>O+
										</option>
										<option value="AB+" {% if user.blood_group=="AB+" %}selected{% endif %}>AB+
										</option>
										<option value="None" {% if user.blood_group=="None" %}selected{% endif %}>None
										</option>
                                    </select>
                                </div>
                                
                            </div>


                            <div class="input-row">
                                <div class="input-group">
                                    <label>Email <span>*</span></label>
                                    <input type="email" name="email"  value="{{user.email}}" required placeholder="" readonly />
                                </div>
                                <div class="input-group">
                                    <label>Contact No <span>*</span></label>
                                    <input type="tel" name="phone"  value="{{user.phonenumber}}" required placeholder="" />
                                </div>
                            </div>

                            <div class="input-row1">
                                <div class="input-group1">
                                    <label>Guardain Name</label>
                                    <input type="name" name="guardian-name" placeholder="" />
                                </div>
                                <div class="input-group1">
                                    <label>Guardain Contact No</label>
                                    <input type="tel" name="guardian-phone" placeholder="" />
                                </div>
                                <div class="input-group1">
                                    <label>Emergency Contact No <span>*</span></label>
                                    <input type="tel" name="emergency-phone" placeholder="" />
                                </div>
                            </div>

                            <label>Address <span>*</span></label>
                  <textarea rows="5" name="address" placeholder=""></textarea>

                  <div class="input-row1">
                    <div class="input-group1">
                        <label>Doctor Name <span>*</span></label>
                        <input type="text" name="doctor-name" value="{{therapist.th_name}}" readonly placeholder="" />
                    </div>
                    <div class="input-group1">
                        <label for="appointment-date">Apointment Date<span>*</span></label>
                        <input type="date" name="appointment-date" id="appointment-date" min="2023-10-14"
                        max="2023-11-14" placeholder="" />
                    </div>
                    <div class="input-group1">
                        <label for="appointment-time">Appointment Time <span>*</span></label>
                        <select type="tel"  name="appointment-time" id="appointment-time" placeholder="" >
                            <option >Select</option>
                        </select>
                    </div>
                </div>

                <label>Appointment Reason <span>*</span></label>
                <textarea class="areatext" name="appointment-reason" rows="5" placeholder=""></textarea>

                <label>Medical History(If Any)</label>
                  <textarea class="areatext" name="medical-history" rows="5" placeholder=""></textarea>

                  <label>Other Relevent Details</label>
                  <textarea class="areatext" name="other-details" rows="5" placeholder=""></textarea>


                           <div id="bookbtn">
                            <button id="send" type="submit">Book</button>
                           </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </div>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document).ready(function () {
			$('#appointment-date').on('change', function () {
				var selectedDate = $(this).val();
				var thId = '{{ therapist.th_id }}';

				// Make an AJAX request to get available times
				$.get('/get_available_times/' + thId, { appointment_date: selectedDate }, function (data) {
					var availableTimes = data.available_times;
					var appointmentTimeSelect = $('#appointment-time');

					// Clear existing options
					appointmentTimeSelect.empty();

					// Add a default option
					appointmentTimeSelect.append($('<option>', { value: "", text: "Select a time" }));

					// Add available times as options
					$.each(availableTimes, function (index, time) {
						appointmentTimeSelect.append($('<option>', { value: time, text: time }));
					});
				});
			});
		});
	</script>
	<script>
		// Function to get the date one month from today
		function getDateOneMonthFromNow() {
			var today = new Date();
			var oneMonthFromNow = new Date(today);
			oneMonthFromNow.setMonth(oneMonthFromNow.getMonth() + 1);
			return oneMonthFromNow;
		}

		var appointmentDateInput = document.getElementById("appointment-date");
		var today = new Date();
		var oneMonthFromNow = getDateOneMonthFromNow();
		appointmentDateInput.min = formatDate(today); // Set the minimum date
		appointmentDateInput.max = formatDate(oneMonthFromNow); // Set the maximum date

		// Function to format the date in 'YYYY-MM-DD' format
		function formatDate(date) {
			var year = date.getFullYear();
			var month = String(date.getMonth() + 1).padStart(2, '0');
			var day = String(date.getDate()).padStart(2, '0');
			return `${year}-${month}-${day}`;
		}
	</script>
    <script>
        const profilepic=document.getElementById("profile-pic");
        const inputfile=document.getElementById("input-file");


        // inputfile.addEventListener("change",()=>{
        //     profilepic.src=URL.createObjectURL(inputfile.files[0]);
        // })

            inputfile.onchange=function(){

                profilepic.src=URL.createObjectURL(inputfile.files[0]);
            }
    </script>
</body>
</html>