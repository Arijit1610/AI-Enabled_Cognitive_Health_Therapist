<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Book Appointment</title>
	<link rel="stylesheet" href="{{ url_for('static', filename = 'css/appointment_style.css')}}">
</head>

<body>
	<div class="container">
		<form action="{{th_id}}" method="post">
			<div class="heading">
				<h1>Fill the Details below</h1>
			</div>
			<div class="name">
				<div class="label">
					<label for="name">Name<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<div>
						<input type="text" id="name" name="name" required>

					</div>
				</div>
			</div>
			<div class="dob">
				<div class="label">
					<label for="dob">Date of Birth<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<input type="date" name="dob" id="dob" required>
				</div>
			</div>
			<div class="gender">
				<div class="label">
					<label for="">Gender<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<div>
						<input type="radio" name="gender" id="male" value="male" required>
						<label for="male">Male</label>
					</div>
					<div>
						<input type="radio" name="gender" id="female" value="female" required>
						<label for="female">Female</label>
					</div>
					<div>
						<input type="radio" name="gender" id="others" value="others"required>
						<label for="others">Others</label>
					</div>
				</div>
			</div>
			<div class="email">
				<div class="label">
					<label for="email">E-Mail<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<input type="email" name="email" id="email" required>
				</div>
			</div>
			<div class="phone">
				<div class="label">
					<label for="phone">Phone Number<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<input type="tel" name="phone" id="phone" required>
				</div>
			</div>
			<div class="guardian_name">
				<div class="label">
					<label for="guardian-name">Guardian Name</label>
				</div>
				<div class="fields">
					<input type="text" name="guardian-name" id="guardian-name">
				</div>
			</div>
			<div class="guardian_phone">
				<div class="label">
					<label for="guardian-phone">Guardian Contact Number</label>
				</div>
				<div class="fields">
					<input type="tel" name="guardian-phone" id="guardian-phone">
				</div>
			</div>
			<div class="emergency_contact">
				<div class="label">
					<label for="emergency-phone">Emergency Contact Number<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<input type="tel" name="emergency-phone" id="emergency-phone" required>
				</div>
			</div>

			<div class="address">
				<div class="label">
					<label for="address">Address<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<!-- <input type="text" name="address" id="address"> -->
					<textarea name="address" id="address" rows="5" placeholder="Write Here..."></textarea>
				</div>
			</div>
			<div class="doctor_name">
				<div class="label">
					<label for="doctor-name">Doctor Name</label>
				</div>
				<div class="fields">
					<input type="text" name="doctor-name" id="doctor-name" value="{{therapist.th_name}}" readonly>
				</div>
			</div>
			<div class="appointment_reason">
				<div class="label">
					<label for="appointment-reason">Appointment Reason<span style="color: red;">*</span></label>
				</div>
				<div class="fields">
					<textarea name="appointment-reason" id="appointment-reason" rows="6"
						placeholder="Write here..."></textarea>
				</div>
			</div>
			<div class="appointment_slot">
				<div class="label">
					<label for="">Appointment Slot</label>
				</div>
				<div class="fields">
					<span><label for="appointment-date">Appointment Date<span style="color: red;">*</span></label></span>
					<span><input type="date" id="appointment-date" name="appointment-date" min="2023-10-14" max="2023-11-14"></span>
					<span><label for="appointment-time">Appointment Time<span style="color: red;">*</span></label></span>
					<span>
						<select id="appointment-time" name="appointment-time">
							<!-- Options will be dynamically added here -->
						</select>
					</span>
				</div>
			</div>
			<div class="medical_history">
				<div class="label">
					<label for="medical-history">Medical History (If Any)</label>
				</div>
				<div class="fields">
					<textarea name="medical-history" id="medical-history" rows="5"
						placeholder="Write here..."></textarea>
				</div>
			</div>
			<div class="other_details">
				<div class="label">
					<label for="other-details">Other Relevant Details</label>
				</div>
				<div class="fields">
					<textarea name="other-details" id="other-details" rows="5" placeholder="Write here..."></textarea>
				</div>
			</div>
			<div class="submission">
				<div>
					<button type="reset">Reset</button>
				</div>
				<div>
					<button type="submit">Book Appointment</button>
				</div>
			</div>
		</form>
	</div>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document).ready(function () {
			$('#appointment-date').on('change', function () {
				var selectedDate = $(this).val();
				var thId = '{{ therapist.th_id }}';

				// Make an AJAX request to get available times
				$.get('/get_available_times/' + thId, { appointment_date: selectedDate }, function (data) {
					var availableTimes = data.available_times;
					var appointmentTimeSelect = $('#appointment-time');

					// Clear existing options
					appointmentTimeSelect.empty();

					// Add a default option
					appointmentTimeSelect.append($('<option>', { value: "", text: "Select a time" }));

					// Add available times as options
					$.each(availableTimes, function (index, time) {
						appointmentTimeSelect.append($('<option>', { value: time, text: time }));
					});
				});
			});
		});
	</script>
	<script>
		// Function to get the date one month from today
		function getDateOneMonthFromNow() {
			var today = new Date();
			var oneMonthFromNow = new Date(today);
			oneMonthFromNow.setMonth(oneMonthFromNow.getMonth() + 1);
			return oneMonthFromNow;
		}

		var appointmentDateInput = document.getElementById("appointment-date");
		var today = new Date();
		var oneMonthFromNow = getDateOneMonthFromNow();
		appointmentDateInput.min = formatDate(today); // Set the minimum date
		appointmentDateInput.max = formatDate(oneMonthFromNow); // Set the maximum date

		// Function to format the date in 'YYYY-MM-DD' format
		function formatDate(date) {
			var year = date.getFullYear();
			var month = String(date.getMonth() + 1).padStart(2, '0');
			var day = String(date.getDate()).padStart(2, '0');
			return `${year}-${month}-${day}`;
		}
	</script>

</body>

</html>